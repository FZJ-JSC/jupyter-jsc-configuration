{% extends "jupyter-jsc.fz-juelich.de/page.html" %}

{% block stylesheet %}
<link rel="stylesheet" href='{{ static_url("css/pages/token.css", include_version=False) }}'
  type="text/css" />
{% endblock %}

{% block main %}
<div id="token-page" class="d-flex text-center">
  <div class="m-auto">

    <form id="request-token-form" class="mx-auto">
      <button type="submit" class="btn btn-lg btn-jupyter">
        Request new API token
      </button>
      <div class="input-group mt-3">
        <div class="input-group-prepend">
          <span class="input-group-text font-weight-bold">Note</span>
        </div>
        <input id="token-note" type="text" class="form-control" placeholder="Note to identify your new token" />
      </div>
      <small id="note-note" class="form-text text-muted mb-3">
        This note will help you keep track of what your tokens are for.
      </small>
    </form>

    <div id="token-area" class="mx-auto" style="display: none">
      <div class="card mb-4">
        <div class="card-header"> Your new API Token </div>
        <div class="card-body">
          <p class="lead">
            <span id="token-result"></span>
          </p>
          <p>
            Copy this token. You won't be able to see it again, but you can
            always come back here to get a new one.
          </p>
        </div>
      </div>
    </div>

    {% if api_tokens %}
    <div id="token-table" class="mx-auto px-4">
      <h2>API Tokens</h2>
      <p class="text-left">
        These are tokens with full access to the JupyterHub API. Anything you can
        do with JupyterHub can be done with these tokens. Revoking the API token
        for a running server will require restarting that server.
      </p>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Note</th>
            <th>Last used</th>
            <th>Created</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for token in api_tokens %}
          <tr data-token-id="{{token.api_id}}">
            {% block token_row scoped %}
            <td class="note-col col-5 align-middle">{{token.note}}</td>
            <td class="time-col col-3 align-middle">
              {%- if token.last_activity -%}
              {{ token.last_activity.isoformat() + 'Z' }}
              {%- else -%}
              Never
              {%- endif -%}
            </td>
            <td class="time-col col-3 align-middle">
              {%- if token.created -%}
              {{ token.created.isoformat() + 'Z' }}
              {%- else -%}
              N/A
              {%- endif -%}
            </td>
            <td class="col-1 text-center">
              <button class="revoke-token-btn btn btn-rounded btn-sm btn-danger">
                revoke
              </button>
            </td>
            {% endblock token_row %}
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% endif %}

    {% if oauth_clients %}
    <div class="mx-auto px-4">
      <h2>Authorized Applications</h2>
      <p class="text-left">
        These are applications that use OAuth with JupyterHub to identify users
        (mostly notebook servers). OAuth tokens can generally only be used to
        identify you, not take actions on your behalf.
      </p>
      <table class="table table-striped">
        <thead>
          <tr>
            <th>Application</th>
            <th>Last used</th>
            <th>First authorized</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          {% for client in oauth_clients %}
          <tr data-token-id="{{ client['token_id'] }}">
            {% block client_row scoped %}
            <td class="note-col col-5 align-middle">{{ client['description'] }}</td>
            <td class="time-col col-3 align-middle">
              {%- if client['last_activity'] -%}
              {{ client['last_activity'].isoformat() + 'Z' }}
              {%- else -%}
              Never
              {%- endif -%}
            </td>
            <td class="time-col col-3 align-middle">
              {%- if client['created'] -%}
              {{ client['created'].isoformat() + 'Z' }}
              {%- else -%}
              N/A
              {%- endif -%}
            </td>
            <td class="col-1 text-center">
              <button class="revoke-token-btn btn btn-rounded btn-sm btn-danger">
                revoke
              </button>
              {% endblock client_row %}
            </td>
          </tr>

          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </div>
</div>




{% endblock main %}

{% block script %} {{ super() }}
<script type="text/javascript">
  require(["token"]);
</script>
{% endblock script %}