{% extends "jupyter-jsc.fz-juelich.de/page.html" %} {% if
announcement_spawn %} {% set announcement = announcement_spawn %} {% endif %} {%
block stylesheet %} <link rel="stylesheet" href="{{
static_url("css/pages/spawn.css", include_version=False) }}" type="text/css"/>
{% endblock %} {% block main %}
<div class="content">
  {% block heading %}
  <div class="row text-center">
    <h1 id="optionsheader">Server Options</h1>
  </div>
  {% endblock %}
  <div class="row col-sm-offset-2 col-sm-8">
    {% if for_user and user.name != for_user.name -%}
    <p>Spawning server for {{ for_user.name }}</p>
    {% endif -%} {% if error_message -%}
    <p class="spawn-error-msg text-danger">Error: {{error_message}}</p>
    {% endif %}
    <form
      enctype="multipart/form-data"
      id="spawn_form"
      action="{{url}}"
      method="post"
      role="form"
    >
      <div class="custom-div">
        <input autocomplete="off" id="vo_active_input" name="vo_active_input"
        value="{{auth_state.get("vo_active")}}" style="display:none">
        <input
          autocomplete="off"
          id="service_input"
          name="service_input"
          value="JupyterLab"
          style="display: none"
        />
        <input
          autocomplete="off"
          id="system_input"
          name="system_input"
          value="undefined"
          style="display: none"
        />
        <input
          autocomplete="off"
          id="account_input"
          name="account_input"
          value="undefined"
          style="display: none"
        />
        <input
          autocomplete="off"
          id="project_input"
          name="project_input"
          value="undefined"
          style="display: none"
        />
        <input
          autocomplete="off"
          id="partition_input"
          name="partition_input"
          value="undefined"
          style="display: none"
        />
        <input
          autocomplete="off"
          id="reservation_input"
          name="reservation_input"
          value="undefined"
          style="display: none"
        />
        {% if (spawner_options_form.get('dropdown_lists', {}).get('systems', [])
        | length > 0) or (spawner_options_form.get('hdfcloud') | length > 0) -%}
        <div id="systems_dropdown" style="display: None">
          <div class="dropdown_custom">
            <label
              for="systems_dropdown_button"
              id="systems_dropdown_label"
              class="bg-primary text-center label_custom"
              >System</label
            >
            <div class="btn-group btn_group_j4spawner">
              {% if spawner_options_form.get('dropdown_lists',
              {}).get('systems', []) | length > 0 -%}
              <button
                type="button"
                onchange="onChangeSystems()"
                class="btn btn-primary dropdown-toggle form-control button_custom"
                data-toggle="dropdown"
                aria-expanded="false"
                id="systems_dropdown_button"
                name="system"
                value="{{spawner_options_form.get('dropdown_lists', {})['systems'][0]}}"
              >
                {{ spawner_options_form.get('dropdown_lists', {})['systems'][0]
                }} <span class="caret"></span>
              </button>
              {% elif spawner_options_form.get('hdfcloud') | length > 0 -%}
              <button
                type="button"
                onchange="onChangeSystems()"
                class="btn btn-primary dropdown-toggle form-control button_custom"
                data-toggle="dropdown"
                aria-expanded="false"
                id="systems_dropdown_button"
                name="system"
                value="hdfcloud"
              >
                HDF-Cloud <span class="caret"></span>
              </button>
              {% endif -%}
              <ul class="dropdown-menu" id="systems_dropdown_ul">
                {% for system in spawner_options_form.get('dropdown_lists',
                {})['systems'] | unique | sort -%}
                <li>
                  <a href="#" onclick="onClickSystems('{{ system }}')"
                    >{{ system }}</a
                  >
                </li>
                {% endfor -%} {% if spawner_options_form.get('hdfcloud') |
                length > 0 -%}
                <li>
                  <a href="#" onclick="onClickSystems('hdfcloud')">HDF-Cloud</a>
                </li>
                {% endif -%}
              </ul>
            </div>
          </div>
        </div>
        <div id="accounts_dropdown" style="display: None">
          <div class="dropdown_custom">
            <label
              for="accounts_dropdown_button"
              id="accounts_dropdown_label"
              class="bg-primary text-center label_custom"
              >Account</label
            >
            <div class="btn-group btn_group_j4spawner">
              <button
                type="button"
                onchange="onChangeAccounts()"
                class="btn btn-primary dropdown-toggle form-control button_custom"
                data-toggle="dropdown"
                aria-expanded="false"
                id="accounts_dropdown_button"
                name="account"
                value=""
              >
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="accounts_dropdown_ul"></ul>
            </div>
          </div>
        </div>
        <div id="projects_dropdown" style="display: None">
          <div class="dropdown_custom">
            <label
              for="projects_dropdown_button"
              id="projects_dropdown_label"
              class="bg-primary text-center label_custom"
              >Project</label
            >
            <div class="btn-group btn_group_j4spawner">
              <button
                type="button"
                onchange="onChangeProjects()"
                class="btn btn-primary dropdown-toggle form-control button_custom"
                data-toggle="dropdown"
                aria-expanded="false"
                id="projects_dropdown_button"
                name="project"
                value=""
              >
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="projects_dropdown_ul"></ul>
            </div>
          </div>
        </div>
        <div id="partitions_dropdown" style="display: None">
          <div class="dropdown_custom">
            <label
              for="partitions_dropdown_button"
              id="partitions_dropdown_label"
              class="bg-primary text-center label_custom"
              >Partition</label
            >
            <div class="btn-group btn_group_j4spawner">
              <button
                type="button"
                onchange="onChangePartitions()"
                class="btn btn-primary dropdown-toggle form-control button_custom"
                data-toggle="dropdown"
                aria-expanded="false"
                id="partitions_dropdown_button"
                name="partition"
                value=""
              >
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="partitions_dropdown_ul"></ul>
            </div>
          </div>
        </div>
        <div id="reservations_dropdown" style="display: None">
          <div class="dropdown_custom">
            <label
              for="reservations_dropdown_button"
              id="reservations_dropdown_label"
              class="bg-primary text-center label_custom"
              >Reservation</label
            >
            <div class="btn-group btn_group_j4spawner">
              <button
                type="button"
                onchange="onChangeReservations()"
                class="btn btn-primary dropdown-toggle form-control button_custom"
                data-toggle="dropdown"
                aria-expanded="false"
                id="reservations_dropdown_button"
                name="reservation"
                value=""
              >
                <span class="caret"></span>
              </button>
              <ul class="dropdown-menu" id="reservations_dropdown_ul"></ul>
            </div>
          </div>
        </div>
        <div id="resource_nodes_div" style="display: none">
          <label
            for="resource_nodes_input"
            id="resource_nodes_label"
            class="resource_label_custom"
            >Nodes [1, 256]</label
          >
          <input
            min="1"
            max="256"
            value="1"
            class="input_custom"
            name="resource_Nodes"
            id="resource_nodes_input"
            type="number"
          />
        </div>
        <div id="resource_runtime_div" style="display: none">
          <label
            for="resource_runtime_input"
            id="resource_runtime_label"
            class="resource_label_custom"
            >Runtime (min) [1, 1440]</label
          >
          <input
            min="1"
            max="1440"
            value="30"
            class="input_custom"
            name="resource_Runtime"
            id="resource_runtime_input"
            type="number"
          />
        </div>
        <div id="resource_gpus_div" style="display: none">
          <label
            for="resource_gpus_input"
            id="resource_gpus_label"
            class="resource_label_custom"
            >GPUs [1, 4]</label
          >
          <input
            min="1"
            max="4"
            value="4"
            class="input_custom"
            name="resource_GPUS"
            id="resource_gpus_input"
            type="number"
          />
        </div>
        <div
          id="reservations_checkbox_div"
          class="checkbox_div_custom"
          style="display: none"
        >
          <li class="bg-primary list-group-item checkbox_li_custom">
            Show reservation info&nbsp;<img
              class="qm_custom"
              id="reservations_checkbox_qm"
              src="https://jupyter-jsc.fz-juelich.de/hub/static/images/qm.png"
              data-original-title=""
              title=""
              height="20"
            />
            <div class="material-switch pull-right" style="">
              <input
                id="reservations_checkbox_input"
                name="reservations_checkbox_input"
                onclick="reservation_cb()"
                class="form-control"
                type="checkbox"
              />
              <label
                for="reservations_checkbox_input"
                class="label-primary"
              ></label>
            </div>
          </li>
        </div>
        <input
          type="submit"
          value="Start"
          class="btn btn-jupyter form-control bottom-button"
        />
        {% else -%}
        <p>
          No systems available. Systems in maintenance: {{
          spawner_options_form.get('maintenance') | join(", ") }}
        </p>
        {% endif -%}
      </div>
    </form>
  </div>
</div>
<div class="content" style="margin-right: 15%">
  <div class="row text-center">
    <h1 style="visibility: hidden">Server Options</h1>
  </div>
  <div
    id="reservation_info_empty_div"
    class="reservation_info_custom"
    style="display: none; overflow-x: auto"
  >
    <table calss="table_custom">
      <tr class="table_tr_custom">
        <th colspan="2" class="table_th_custom" style="color: red">
          Please choose a reservation
        </th>
      </tr>
    </table>
  </div>
  <div
    id="reservation_info_div"
    class="reservation_info_custom"
    style="display: none; overflow-x: auto"
  >
    <table calss="table_custom">
      <tr class="table_tr_custom">
        <th colspan="2" class="table_th_custom" id="reservation_table_name">
          Reservation: Name
        </th>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_state_left" class="table_tdl_custom">
          State
        </td>
        <td id="reservation_table_state_right" class="table_tdr_custom">
          INACTIVE
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_users_left" class="table_tdl_custom">
          Users
        </td>
        <td id="reservation_table_users_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_accounts_left" class="table_tdl_custom">
          Accounts
        </td>
        <td id="reservation_table_accounts_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_partition_left" class="table_tdl_custom">
          PartitionName
        </td>
        <td id="reservation_table_partition_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_start_left" class="table_tdl_custom">
          StartTime
        </td>
        <td id="reservation_table_start_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_end_left" class="table_tdl_custom">
          EndTime
        </td>
        <td id="reservation_table_end_right" class="table_tdr_custom">Value</td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_duration_left" class="table_tdl_custom">
          Duration
        </td>
        <td id="reservation_table_duration_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_nodescnt_left" class="table_tdl_custom">
          NodeCnt
        </td>
        <td id="reservation_table_nodescnt_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_nodes_left" class="table_tdl_custom">
          Nodes
        </td>
        <td id="reservation_table_nodes_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_corecnt_left" class="table_tdl_custom">
          CoreCnt
        </td>
        <td id="reservation_table_corecnt_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_tres_left" class="table_tdl_custom">TRES</td>
        <td id="reservation_table_tres_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_features_left" class="table_tdl_custom">
          Features
        </td>
        <td id="reservation_table_features_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_flags_left" class="table_tdl_custom">
          Flags
        </td>
        <td id="reservation_table_flags_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_licenses_left" class="table_tdl_custom">
          Licenses
        </td>
        <td id="reservation_table_licenses_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_burstbuffer_left" class="table_tdl_custom">
          BurstBuffer
        </td>
        <td id="reservation_table_burstbuffer_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
      <tr class="table_tr_custom">
        <td id="reservation_table_watts_left" class="table_tdl_custom">
          Watts
        </td>
        <td id="reservation_table_watts_right" class="table_tdr_custom">
          Value
        </td>
      </tr>
    </table>
  </div>
</div>
{% endblock %} {% block script %}
<script type="text/javascript">
  require(["home"]);
  $(document).ready(function() {
    $("#optionsheader").html("JupyterLab Options");
    var ls_system = localStorage.getItem("jupyterlab_system");
    var ls_account = localStorage.getItem("jupyterlab_account");
    var ls_project = localStorage.getItem("jupyterlab_project");
    var ls_partition = localStorage.getItem("jupyterlab_partition");
    var ls_reservation = localStorage.getItem("jupyterlab_reservation");
    if (ls_system != null && ls_system != "null") {
      if (! $("#systems_dropdown_ul").html().includes(ls_system)) {
      {% if spawner_options_form.get('dropdown_lists', {}).get('systems', []) | length > 0 -%}
        onClickSystems({{ spawner_options_form.get('dropdown_lists', {})['systems'][0] | tojson }});
        $("#systems_dropdown").show();
      {% elif spawner_options_form.get('hdfcloud') | length > 0 -%}
        onClickSystems("hdfcloud");
        $("#systems_dropdown").show();
      {% endif -%}
      return;
      }
      onClickSystems(ls_system);
      $("#systems_dropdown").show();
      if (ls_account != null && ls_account != "null") {
        if (! $("#accounts_dropdown_ul").html().includes(ls_account)) {
          return;
        }
        onClickAccounts(ls_account);
        if (ls_project != null && ls_project != "null") {
          if (! $("#projects_dropdown_ul").html().includes(ls_project)) {
          return;
          }
          onClickProjects(ls_project);
          if (ls_partition != null && ls_partition != "null") {
            if (! $("#partitions_dropdown_ul").html().includes(">"+ls_partition+"<")) {
              return;
            }
            onClickPartitions(ls_partition);
            if (ls_reservation != null && ls_reservation != "null") {
              if (! $("#reservations_dropdown_ul").html().includes(ls_reservation)) {
                return;
              }
              onClickReservations(ls_reservation);
            }
          }
        }
      }
    } else {
      {% if spawner_options_form.get('dropdown_lists', {}).get('systems', []) | length > 0 -%}
        onClickSystems({{ spawner_options_form.get('dropdown_lists', {})['systems'][0] | tojson }});
        $("#systems_dropdown").show();
      {% elif spawner_options_form.get('hdfcloud') | length > 0 -%}
        onClickSystems("hdfcloud");
        $("#systems_dropdown").show();
      {% endif -%}
    }
  })
  function onClickSystems(value) {
    var old = $("system_input").val();
    if ( old == value ) {
      return;
    }
    $("#systems_dropdown_button").val(value).trigger("change");
    localStorage.setItem("jupyterlab_system", $("#system_input").val());
    localStorage.setItem("jupyterlab_account", $("#account_input").val());
    localStorage.setItem("jupyterlab_project", $("#project_input").val());
    localStorage.setItem("jupyterlab_partition", $("#partition_input").val());
    localStorage.setItem("jupyterlab_reservation", $("#reservation_input").val());
  }
  function onClickAccounts(value) {
    var old = $("account_input").val();
    if ( old == value ) {
      return;
    }
    $("#accounts_dropdown_button").val(value).trigger("change");
    localStorage.setItem("jupyterlab_account", $("#account_input").val());
    localStorage.setItem("jupyterlab_project", $("#project_input").val());
    localStorage.setItem("jupyterlab_partition", $("#partition_input").val());
    localStorage.setItem("jupyterlab_reservation", $("#reservation_input").val());
  }
  function onClickProjects(value) {
    var old = $("project_input").val();
    if ( old == value ) {
      return;
    }
    $("#projects_dropdown_button").val(value).trigger("change");
    localStorage.setItem("jupyterlab_project", $("#project_input").val());
    localStorage.setItem("jupyterlab_partition", $("#partition_input").val());
    localStorage.setItem("jupyterlab_reservation", $("#reservation_input").val());
  }
  function onClickPartitions(value) {
    var old = $("partition_input").val();
    if ( old == value ) {
      return;
    }
    $("#partitions_dropdown_button").val(value).trigger("change");
    localStorage.setItem("jupyterlab_partition", $("#partition_input").val());
    localStorage.setItem("jupyterlab_reservation", $("#reservation_input").val());
  }
  function onClickReservations(value) {
    var old = $("reservation_input").val();
    if ( old == value ) {
      return;
    }
    $("#reservations_dropdown_button").val(value).trigger("change");
    localStorage.setItem("jupyterlab_reservation", $("#reservation_input").val());
  }
  function onChangeSystems() {
    var system = $('#systems_dropdown_button').val();
    $('#system_input').val(system);
    $('#accounts_dropdown').hide();
    $('#projects_dropdown').hide();
    $('#partitions_dropdown').hide();
    $('#resource_nodes_div').hide();
    $('#resource_runtime_div').hide();
    $('#resource_gpus_div').hide();
    $('#reservations_dropdown').hide();
    $('#reservations_checkbox_div').hide();
    $('#reservations_checkbox_input').prop("checked", false);
    $('#reservation_info_empty_div').hide();
    $('#reservation_info_div').hide();
    $('#account_input').val("undefined");
    $('#project_input').val("undefined");
    $('#partition_input').val("undefined");
    $('#reservation_input').val("undefined");
    if ( system == "hdfcloud" ){
      $('#systems_dropdown_button').html('HDF-Cloud <span class=\"caret\"></span>');
      $('#accounts_dropdown_label').html('Image');
      $('#accounts_dropdown_ul').html("");
      {% for image in spawner_options_form.get('hdfcloud') | unique | sort -%}
        $('#accounts_dropdown_ul').append('<li><a href="#" onclick="onClickAccounts(\'{{image}}\')">{{image}}</a></li>');
      {% endfor -%}
      $('#accounts_dropdown_button').val("{{ spawner_options_form.get('hdfcloud') | list | first }}").trigger("change");
      $('#accounts_dropdown').show();
    } else {
      $('#systems_dropdown_button').html(system + ' <span class=\"caret\"></span>');
      {% for system, accounts in spawner_options_form.get('dropdown_lists').get('accounts', {}).items() -%}
        if( system == {{ system | tojson }} ){
          $('#accounts_dropdown_label').html('Account');
          $('#accounts_dropdown_ul').html("");
          {% for account in accounts | unique | sort -%}
            $('#accounts_dropdown_ul').append('<li><a href="#" onclick="onClickAccounts(\'{{account}}\')">{{account}}</a></li>');
          {% endfor -%}
          $('#accounts_dropdown_button').val("{{accounts[0]}}").trigger("change");
          $('#accounts_dropdown').show();
        }
      {% endfor -%}
    }
  }

  function onChangeAccounts() {
    var system = $('#system_input').val();
    var account = $('#accounts_dropdown_button').val();
    $('#projects_dropdown').hide();
    $('#partitions_dropdown').hide();
    $('#resource_nodes_div').hide();
    $('#resource_runtime_div').hide();
    $('#resource_gpus_div').hide();
    $('#reservations_dropdown').hide();
    $('#reservations_checkbox_div').hide();
    $('#reservations_checkbox_input').prop("checked", false);
    $('#reservation_info_empty_div').hide();
    $('#reservation_info_div').hide();
    $('#account_input').val(account);
    $('#project_input').val("undefined");
    $('#partition_input').val("undefined");
    $('#reservation_input').val("undefined");
    $('#accounts_dropdown_button').html(account + ' <span class=\"caret\"></span>');
    {% for system, accounts in spawner_options_form.get('dropdown_lists').get('projects', {}).items() -%}
      {% for account, projects in accounts.items() -%}
        if ( system == {{ system | tojson }} && account == {{ account | tojson }} ){
          $('#projects_dropdown_label').html('Project');
          $('#projects_dropdown_ul').html("");
          {% for project in projects | unique | sort -%}
            $('#projects_dropdown_ul').append('<li><a href="#" onclick="onClickProjects(\'{{project}}\')">{{project}}</a></li>');
          {% endfor -%}
          $('#projects_dropdown_button').val("{{projects[0]}}").trigger("change");
          $('#projects_dropdown').show();
        }
      {% endfor -%} {# account -#}
    {% endfor -%} {# system -#}
  }

  function onChangeProjects() {
    var system = $('#system_input').val();
    var account = $('#account_input').val();
    var project = $('#projects_dropdown_button').val();
    $('#partitions_dropdown').hide();
    $('#resource_nodes_div').hide();
    $('#resource_runtime_div').hide();
    $('#resource_gpus_div').hide();
    $('#reservations_dropdown').hide();
    $('#reservations_checkbox_div').hide();
    $('#reservations_checkbox_input').prop("checked", false);
    $('#reservation_info_empty_div').hide();
    $('#reservation_info_div').hide();
    $('#project_input').val(project);
    $('#partition_input').val("undefined");
    $('#reservation_input').val("undefined");
    $('#projects_dropdown_button').html(project + ' <span class=\"caret\"></span>');
    {% for system, accounts in spawner_options_form.get('dropdown_lists').get('partitions', {}).items() -%}
      {% for account, projects in accounts.items() -%}
        {% for project, partitions in projects.items() -%}
          if ( system == {{ system | tojson }} && account == {{ account | tojson }} &&
            project == {{ project | tojson }} ){
            $('#partitions_dropdown_label').html('Partition');
            $('#partitions_dropdown_ul').html("");
            {% set first_partition = {'foo':Ffalse} %}
            {% if 'LoginNode' in spawner_options_form.get('resources').get(system, {}).keys() and ( auth_state.get("vo_active") not in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).keys() or 'LoginNode' in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).get(auth_state.get("vo_active"), []) ) -%}
              {% if first_partition.update({"foo": "LoginNode"}) %} {% endif %}
              $('#partitions_dropdown_ul').append('<li><a href="#" onclick="onClickPartitions(\'LoginNode\')">LoginNode</a></li>');
            {% endif -%}
            {% if 'LoginNodeVis' in spawner_options_form.get('resources').get(system, {}).keys() and ( auth_state.get("vo_active") not in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).keys() or 'LoginNodeVis' in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).get(auth_state.get("vo_active"), []) ) -%}
              {% if not first_partition.get("foo") -%}
                {% if first_partition.update({"foo": "LoginNodeVis"}) -%} {% endif -%}
              {% endif -%}
              $('#partitions_dropdown_ul').append('<li><a href="#" onclick="onClickPartitions(\'LoginNodeVis\')">LoginNodeVis</a></li>');
            {% endif -%}
            {% if 'LoginBooster' in spawner_options_form.get('resources').get(system, {}).keys() and ( auth_state.get("vo_active") not in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).keys() or 'LoginBooster' in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).get(auth_state.get("vo_active"), []) ) -%}
              {% if not first_partition.get("foo") -%}
                {% if first_partition.update({"foo": "LoginBooster"}) -%} {% endif -%}
              {% endif -%}
              $('#partitions_dropdown_ul').append('<li><a href="#" onclick="onClickPartitions(\'LoginBooster\')">LoginBooster</a></li>');
            {% endif -%}
            {% for partition in partitions | unique | sort -%}
              {% if auth_state.get("vo_active") not in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).keys() or partition in spawner_options_form.get('unicore_vo', {}).get(system, {}).get('vo_exclusive_partition', {}).get(auth_state.get("vo_active"), []) -%}
                {% if not first_partition.get("foo") -%}
                  {% if first_partition.update({"foo": partition }) -%} {% endif -%}
                {% endif -%}
                $('#partitions_dropdown_ul').append('<li><a href="#" onclick="onClickPartitions(\'{{partition}}\')">{{partition}}</a></li>');
              {% endif -%}
            {% endfor -%}
            $('#partitions_dropdown_button').val("{{ first_partition.get('foo') }}").trigger("change");
            $('#partitions_dropdown').show();
          }
        {% endfor -%} {# project -#}
      {% endfor -%} {# account -#}
    {% endfor -%} {# system -#}
  }
  function onChangePartitions() {
    var system = $('#system_input').val();
    var account = $('#account_input').val();
    var project = $('#project_input').val();
    var partition = $('#partitions_dropdown_button').val();
    $('#resource_nodes_div').hide();
    $('#resource_runtime_div').hide();
    $('#resource_gpus_div').hide();
    $('#reservations_dropdown').hide();
    $('#reservations_checkbox_div').hide();
    $('#reservations_checkbox_input').prop("checked", false);
    $('#reservation_info_empty_div').hide();
    $('#reservation_info_div').hide();
    $('#partition_input').val(partition);
    $('#reservation_input').val("undefined");
    $('#partitions_dropdown_button').html(partition + ' <span class=\"caret\"></span>');
    {% set reservations = [] -%}
    {% for system, accounts in spawner_options_form.get('dropdown_lists').get('reservations', {}).items() -%}
      {% for account, projects in accounts.items() -%}
        {% for project, partitions in projects.items() -%}
          {% for partition, reservations in partitions.items() -%}
          if ( system == {{ system | tojson }} && account == {{ account | tojson }} &&
            project == {{ project | tojson }} && partition == {{ partition | tojson }} ){
            {% if "Nodes" in spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}) -%}
              {% if "Nodes" in unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).keys() -%}
                $('#resource_nodes_label').html("Nodes [{{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Nodes",[0,1])[0] }}, {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Nodes",[0,1])[1] }}]");
                $('#resource_nodes_input').attr({
                  "min": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Nodes",[0,1])[0] }},
                  "max": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Nodes",[0,1])[1] }},
                  "value": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Nodes",[0,1])[0] }},
                });
              {% else -%}
                $('#resource_nodes_label').html( {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Nodes", {}).get("TEXT", "Nodes") | tojson }});
                $('#resource_nodes_input').attr({
                  "min": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Nodes", {}).get("MINMAX", [0, 1])[0] }},
                  "max": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Nodes", {}).get("MINMAX", [0, 1])[1] }},
                  "value": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Nodes", {}).get("DEFAULT", 0) }},
                });
              {% endif -%}
              $('#resource_nodes_div').show();
            {% endif -%}
            {% if "Runtime" in spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}) -%}
              {% if "Runtime" in unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).keys() -%}
                $('#resource_runtime_label').html("Runtime (min) [{{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Runtime",[0,1])[0] }}, {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Runtime",[0,1])[1] }}]");
                $('#resource_runtime_input').attr({
                  "min": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Runtime",[0,1])[0] }},
                  "max": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Runtime",[0,1])[1] }},
                  "value": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("Runtime",[0,1])[0] }},
                });
              {% else -%}
                $('#resource_runtime_label').html( {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Runtime", {}).get("TEXT", "Runtime") | tojson }});
                $('#resource_runtime_input').attr({
                  "min": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Runtime", {}).get("MINMAX", [0, 1])[0] }},
                  "max": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Runtime", {}).get("MINMAX", [0, 1])[1] }},
                  "value": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("Runtime", {}).get("DEFAULT", 0) }},
                });
              {% endif -%}
              $('#resource_runtime_div').show();
            {% endif -%}
            {% if "GPUS" in spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}) -%}
              {% if "GPUS" in unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).keys() -%}
                $('#resource_gpus_label').html("GPUs [{{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("GPUS",[0,1])[0] }}, {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("GPUS",[0,1])[1] }}]");
                $('#resource_gpus_input').attr({
                  "min": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("GPUS",[0,1])[0] }},
                  "max": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("GPUS",[0,1])[1] }},
                  "value": {{ unicore_config.get(system, {}).get("vo_limit_resources", {}).get(auth_state.get("vo_active"), {}).get(partition, {}).get("GPUS",[0,1])[1] }},
                });
              {% else -%}
                $('#resource_gpus_label').html( {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("GPUS", {}).get("TEXT", "GPUs") | tojson }});
                $('#resource_gpus_input').attr({
                  "min": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("GPUS", {}).get("MINMAX", [0, 1])[0] }},
                  "max": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("GPUS", {}).get("MINMAX", [0, 1])[1] }},
                  "value": {{ spawner_options_form.get('resources', {}).get(system, {}).get(partition, {}).get("GPUS", {}).get("DEFAULT", 0) }},
                });
              {% endif -%}
              $('#resource_gpus_div').show();
            {% endif -%}
            {% if reservations | length > 0 -%}
              $('#reservations_dropdown_label').html('Reservation');
              $('#reservations_dropdown_ul').html("");
              {% if partition not in unicore_config.get(system, {}).get("vo_force_reservation", {}).get(auth_state.get("vo_active"), {}).keys() -%}
                $('#reservations_dropdown_ul').append('<li><a href="#" onclick="onClickReservations(\'None\')">None</a></li>');
              {% endif -%}
              {% for reservation in reservations | sort -%}
                {# Check Reservation Info Dict for more information #}
                {% for reservation_line in spawner_options_form.get('reservations', {}).get(system, []) -%}
                  {% if reservation == reservation_line[0] -%}
                    {% if partition not in unicore_config.get(system, {}).get("vo_force_reservation", {}).get(auth_state.get("vo_active"), {}).keys() or reservation in unicore_config.get(system, {}).get("vo_force_reservation", {}).get(auth_state.get("vo_active"), {}).get(partition, []) -%}
                      {% if reservation_line[14] == "INACTIVE" -%}
                        $('#reservations_dropdown_ul').append('<li><a href="#" style="text-decoration:line-through; color:red" onclick="onClickReservations(\'{{reservation}}\')">{{reservation}}</a></li>');
                      {% else -%}
                        $('#reservations_dropdown_ul').append('<li><a href="#" onclick="onClickReservations(\'{{reservation}}\')">{{reservation}}</a></li>');
                      {% endif -%}
                    {% endif -%}
                  {% endif -%}
                {% endfor -%}
              {% endfor -%}
              {% if partition in unicore_config.get(system, {}).get("vo_force_reservation", {}).get(auth_state.get("vo_active"), {}).keys() -%}
                $('#reservations_dropdown_button').val("{{unicore_config.get(system, {}).get("vo_force_reservation", {}).get(auth_state.get("vo_active"), {}).get(partition, ["None"])[0]}}").trigger("change");
              {% else -%}
                $('#reservations_dropdown_button').val("None").trigger("change");
              {% endif -%}
              $('#reservations_dropdown').show();
            {% else %}
              $('#reservations_dropdown').hide();
            {% endif -%}
          }
          {% endfor -%} {# partition -#}
        {% endfor -%} {# project -#}
      {% endfor -%} {# account -#}
    {% endfor -%} {# system -#}
  }

  function onChangeReservations() {
    var system = $('#system_input').val();
    var reservation = $('#reservations_dropdown_button').val();
    $('#reservation_input').val(reservation);
    {% for system, reservation_list in spawner_options_form.get("reservations", {}).items() -%}
      if ( system == {{ system | tojson }} ) {
        if (reservation == "None" || reservation == "" || reservation == "undefined" ){
          $('#reservations_dropdown_button').html(reservation + ' <span class=\"caret\"></span>');
          $('#reservations_dropdown_button').css("text-decoration", "none").css("color", "black");
        }
        {% for reservation in reservation_list -%}
          if ( reservation == {{ reservation[0] | tojson }} ) {
            $('#reservations_dropdown_button').html({{ reservation[0] | tojson }} + ' <span class=\"caret\"></span>');
            if ( {{ reservation[14] | tojson }} == "INACTIVE" ) {
              $('#reservations_dropdown_button').css("text-decoration", "line-through").css("color", "red");
              $('#reservation_input').val("None");
            } else {
              $('#reservations_dropdown_button').css("text-decoration", "none").css("color", "black");
              $('#reservation_input').val(reservation);
            }
          }
        {% endfor -%}
      }
    {% endfor -%}
    if ( reservation == "None" || reservation == "" || reservation == "undefined" ) {
      if ( $('#reservations_checkbox_input').is(":checked") ) {
        $('#reservation_info_div').hide();
        $('#reservation_info_empty_div').show();
      }
    } else {
      {% for system, reservation_list in spawner_options_form.get("reservations", {}).items() -%}
        if ( system == {{ system | tojson }} ){
          {% for reservation in reservation_list -%}
            if ( reservation == {{ reservation[0] | tojson }} ){
              if ( "INACTIVE" == {{ reservation[14] | tojson }} ){
                $("#reservation_table_state_left").css("color", "red").css("font-weight", "bold");
                $("#reservation_table_state_right").css("color", "red").css("font-weight", "bold");
              } else {
                $("#reservation_table_state_right").css("color", "black").css("font-weight", "normal");
                $("#reservation_table_state_left").css("color", "black").css("font-weight", "normal");
              }
              $("#reservation_table_name").html( {{ reservation[0] | tojson }} );
              $("#reservation_table_start_right").html( {{ reservation[1] | tojson }} );
              $("#reservation_table_end_right").html( {{ reservation[2] | tojson }} );
              $("#reservation_table_duration_right").html( {{ reservation[3] | tojson }} );
              $("#reservation_table_nodes_right").html( {{ reservation[4] | tojson }} );
              $("#reservation_table_nodescnt_right").html( {{ reservation[5] | tojson }} );
              $("#reservation_table_corecnt_right").html( {{ reservation[6] | tojson }} );
              $("#reservation_table_features_right").html( {{ reservation[7] | tojson }} );
              $("#reservation_table_partition_right").html( {{ reservation[8] | tojson }} );
              $("#reservation_table_flags_right").html( {{ reservation[9] | tojson }} );
              $("#reservation_table_tres_right").html( {{ reservation[10] | tojson }} );
              $("#reservation_table_users_right").html( {{ reservation[11] | tojson }} );
              $("#reservation_table_accounts_right").html( {{ reservation[12] | tojson }} );
              $("#reservation_table_licenses_right").html( {{ reservation[13] | tojson }} );
              $("#reservation_table_state_right").html( {{ reservation[14] | tojson }} );
              $("#reservation_table_burstbuffer_right").html( {{ reservation[15] | tojson }} );
              $("#reservation_table_watts_right").html( {{ reservation[16] | tojson }} );
              if ( $('#reservations_checkbox_input').is(":checked") ) {
                $('#reservation_info_empty_div').hide();
                $('#reservation_info_div').show();
              }
            }
          {% endfor -%}
        }
      {% endfor -%}
    }
    $('#reservations_checkbox_div').show();
  }
  function reservation_cb() {
    var reservation = $('#reservations_dropdown_button').val();
    if ( $('#reservations_checkbox_input').is(":checked") ) {
      if ( reservation == "None" || reservation == "undefined" || reservation == "" ){
        $('#reservation_info_div').hide();
        $('#reservation_info_empty_div').show();
      } else {
        $('#reservation_info_div').show();
        $('#reservation_info_empty_div').hide();
      }
    } else {
      $('#reservation_info_div').hide();
      $('#reservation_info_empty_div').hide();
    }
  }
</script>
{% endblock script %}
